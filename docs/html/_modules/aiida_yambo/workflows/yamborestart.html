

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida_yambo.workflows.yamborestart &mdash; yambo-aiida 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within yambo-aiida 0.1.0 documentation"
          href="../../../_static/opensearch.xml"/>

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> yambo-aiida
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide/get_started/index.html">Get started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide/workflows/index.html">Workflows for AiiDA-Yambo</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../module_guide/index.html">Modules provided with aiida-yambo (API reference)</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">yambo-aiida</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>aiida_yambo.workflows.yamborestart</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida_yambo.workflows.yamborestart</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">RemoteData</span>
<span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">Str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Int</span>

<span class="kn">from</span> <span class="nn">aiida.common</span> <span class="k">import</span> <span class="n">ValidationError</span>

<span class="kn">from</span> <span class="nn">aiida.engine</span> <span class="k">import</span> <span class="n">WorkChain</span><span class="p">,</span> <span class="n">while_</span>
<span class="kn">from</span> <span class="nn">aiida.engine</span> <span class="k">import</span> <span class="n">ToContext</span>
<span class="kn">from</span> <span class="nn">aiida.engine</span> <span class="k">import</span> <span class="n">submit</span>

<span class="kn">from</span> <span class="nn">aiida_yambo.calculations.gw</span> <span class="k">import</span> <span class="n">YamboCalculation</span>



<div class="viewcode-block" id="YamboRestartWf"><a class="viewcode-back" href="../../../module_guide/workflows.html#aiida_yambo.workflows.yamborestart.YamboRestartWf">[docs]</a><span class="k">class</span> <span class="nc">YamboRestartWf</span><span class="p">(</span><span class="n">WorkChain</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This module interacts directly with the yambo plugin to submit calculations</span>

<span class="sd">    This module submits calculations using the yambo plugin, and manages them, including</span>
<span class="sd">    restarting the calculation in case of:</span>
<span class="sd">    1. Memory problems (will reduce MPI parallelism before resubmitting) -- to be fixed</span>
<span class="sd">    2. Queue time exhaustions (will increase time by a fraction before resubmitting)</span>
<span class="sd">    3. Parallelism errors (will reduce the MPI the parallelism before resubmitting)  -- to be fixed</span>
<span class="sd">    4. Errors originating from a few select unphysical input parameters like too low bands.  -- to be fixed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">define</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">YamboRestartWf</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">expose_inputs</span><span class="p">(</span><span class="n">YamboCalculation</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;gw&#39;</span><span class="p">,</span> <span class="n">namespace_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> \
                            <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;parent_folder&#39;</span><span class="p">])</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s2">&quot;parent_folder&quot;</span><span class="p">,</span> <span class="n">valid_type</span><span class="o">=</span><span class="n">RemoteData</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s2">&quot;max_restarts&quot;</span><span class="p">,</span> <span class="n">valid_type</span><span class="o">=</span><span class="n">Int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Int</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="c1">#key: &#39;max_restarts&#39;</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s2">&quot;max_walltime&quot;</span><span class="p">,</span> <span class="n">valid_type</span><span class="o">=</span><span class="n">Int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Int</span><span class="p">(</span><span class="mi">86400</span><span class="p">))</span>


<span class="c1">##################################### OUTLINE ####################################</span>

        <span class="n">spec</span><span class="o">.</span><span class="n">outline</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">yambobegin</span><span class="p">,</span>
            <span class="n">while_</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">yambo_should_restart</span><span class="p">)(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">yambo_restart</span><span class="p">),</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">report_wf</span><span class="p">,</span>
        <span class="p">)</span>


<span class="c1">###################################################################################</span>

        <span class="n">spec</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s1">&#39;last_calc_folder&#39;</span><span class="p">,</span> <span class="n">valid_type</span> <span class="o">=</span> <span class="n">RemoteData</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The last calculation remote folder.&#39;</span><span class="p">)</span>

        <span class="c1">#spec.exit_code(201, &#39;WORKFLOW_NOT_COMPLETED&#39;,message=&#39;Workflow failed&#39;)</span>



<div class="viewcode-block" id="YamboRestartWf.yambobegin"><a class="viewcode-back" href="../../../module_guide/workflows.html#aiida_yambo.workflows.yamborestart.YamboRestartWf.yambobegin">[docs]</a>    <span class="k">def</span> <span class="nf">yambobegin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setup of the calculation and run</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">restart</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># setup #</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exposed_inputs</span><span class="p">(</span><span class="n">YamboCalculation</span><span class="p">,</span> <span class="s1">&#39;gw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;parent_folder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parent_folder</span>

        <span class="c1">#timing corrections -&gt; minimum 5 minutes? must be here, check if done in parser</span>

        <span class="c1"># submission of the first try #</span>
        <span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">YamboCalculation</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Workflow started, submitted process with pk = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">future</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">restart</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">ToContext</span><span class="p">(</span><span class="n">calc</span> <span class="o">=</span> <span class="n">future</span><span class="p">)</span></div>



<div class="viewcode-block" id="YamboRestartWf.yambo_should_restart"><a class="viewcode-back" href="../../../module_guide/workflows.html#aiida_yambo.workflows.yamborestart.YamboRestartWf.yambo_should_restart">[docs]</a>    <span class="k">def</span> <span class="nf">yambo_should_restart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This function encodes the logic to restart calculations from failures</span>
<span class="sd">        ---&gt; I want to do the error detection at the parser level..</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">calc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">calc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Checking if yambo restart is needed&quot;</span><span class="p">)</span>

        <span class="c1">### check of the number of restarts ###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">restart</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">max_restarts</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span>
                <span class="s2">&quot;I will not restart: maximum restarts reached: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">max_restarts</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span>
                <span class="s2">&quot;I can restart (# </span><span class="si">{}</span><span class="s2">), max restarts (</span><span class="si">{}</span><span class="s2">) not reached yet&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">restart</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">max_restarts</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

        <span class="c1">### check if the calculation is failed ###</span>
        <span class="k">if</span> <span class="n">calc</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;All went ok, I will not restart&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;Some error occurred, checking&#39;</span><span class="p">)</span>

        <span class="c1">### error check ###</span>
            <span class="k">if</span> <span class="n">calc</span><span class="o">.</span><span class="n">is_killed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;Killed from AiiDA for unknown reasons, we try to resubmit&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">calc</span><span class="o">.</span><span class="n">is_excepted</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;excepted for unknown reasons, we try to resubmit just one time&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">restart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">max_restarts</span><span class="o">.</span><span class="n">value</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">calc</span><span class="o">.</span><span class="n">exit_status</span> <span class="o">==</span> <span class="mi">300</span> <span class="ow">or</span> <span class="n">calc</span><span class="o">.</span><span class="n">exit_status</span> <span class="o">==</span> <span class="mi">303</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span>
                    <span class="s2">&quot;Calculation </span><span class="si">{}</span><span class="s2"> failed or did not generate outputs for unknown reason, restarting with no changes&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="c1">#walltime exceeded#</span>
            <span class="k">if</span> <span class="n">calc</span><span class="o">.</span><span class="n">exit_status</span> <span class="o">==</span> <span class="mi">101</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">fix_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">restart</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">max_walltime</span><span class="p">)</span>

                <span class="n">update_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span><span class="s1">&#39;PARENT_DB&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># to link the db</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span>
                    <span class="s2">&quot;Failed calculation, likely queue time exhaustion, restarting with new max_input_seconds = </span><span class="si">{}</span><span class="s2">&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">])))</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">calc</span><span class="o">.</span><span class="n">exit_status</span> <span class="o">==</span> <span class="mi">302</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;Something goes wrong, but we don</span><span class="se">\&#39;</span><span class="s1">t know what&#39;</span><span class="p">)</span>
                <span class="n">new_settings</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get_dict</span><span class="p">()</span>
                <span class="n">new_settings</span><span class="p">[</span><span class="s1">&#39;HARD_LINK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;Trying to hard copy the SAVE&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">new_settings</span><span class="p">)</span> <span class="c1"># to link the db</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="c1"># parallelization errors # but there should be something already in yambo...but mpi-openmpi balance #</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            if calc.exit_status == 304:</span>
<span class="sd">                self.ctx.inputs.metadata.options = fix_parallelism(self.ctx.inputs)</span>
<span class="sd">                self.report(&quot;Calculation {} failed likely from parallelism errors&quot;.format(calc))</span>
<span class="sd">                return False</span>

<span class="sd">            if calc.exit_status == 305:</span>
<span class="sd">                self.ctx.inputs.metadata.options = fix_memory(self.ctx.inputs)</span>
<span class="sd">                self.report(&quot;Calculation {} failed likely from memory issues&quot;.format(calc))</span>
<span class="sd">                return False</span>
<span class="sd">        &#39;&#39;&#39;</span></div>


<div class="viewcode-block" id="YamboRestartWf.yambo_restart"><a class="viewcode-back" href="../../../module_guide/workflows.html#aiida_yambo.workflows.yamborestart.YamboRestartWf.yambo_restart">[docs]</a>    <span class="k">def</span> <span class="nf">yambo_restart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submits a yambo calculation using the yambo plugin</span>

<span class="sd">        This function submits a calculation, usually this represents a</span>
<span class="sd">        resubmission of a failed calculation, or a continuation from P2Y/Init run.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">calc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">calc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Now we restart&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">calc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;restart calculations cannot start: calculation not found&quot;</span><span class="p">)</span>
            <span class="c1">#return self.exit_code.WFL_NOT_COMPLETED</span>

        <span class="k">if</span> <span class="n">calc</span><span class="o">.</span><span class="n">exit_status</span> <span class="o">==</span> <span class="mi">102</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parent_folder</span> <span class="o">=</span> <span class="n">calc</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remote_folder</span>

        <span class="c1"># submission of the next try #</span>
        <span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">YamboCalculation</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Workflow started, submitted process with pk = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">future</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">restart</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">ToContext</span><span class="p">(</span><span class="n">calc</span> <span class="o">=</span> <span class="n">future</span><span class="p">)</span></div>



<div class="viewcode-block" id="YamboRestartWf.report_wf"><a class="viewcode-back" href="../../../module_guide/workflows.html#aiida_yambo.workflows.yamborestart.YamboRestartWf.report_wf">[docs]</a>    <span class="k">def</span> <span class="nf">report_wf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Report the outputs of the workchain</span>

<span class="sd">        Output final quantities</span>
<span class="sd">        return information that may be used to figure out</span>
<span class="sd">        the status of the calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">calc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">calc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;workflow completed successfully: </span><span class="si">{}</span><span class="s2">, last calculation was &lt;</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">,</span> <span class="n">calc</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="s1">&#39;last_calc_folder&#39;</span><span class="p">,</span> <span class="n">calc</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remote_folder</span><span class="p">)</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2020, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and CNR NANO Modena, Italy. All rights reserved.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>