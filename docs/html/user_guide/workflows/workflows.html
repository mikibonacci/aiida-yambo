

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Yambo Workflows Tutorial &mdash; yambo-aiida 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within yambo-aiida 0.1.0 documentation"
          href="../../_static/opensearch.xml"/>

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Modules provided with aiida-yambo (API reference)" href="../../module_guide/index.html" />
    <link rel="prev" title="Workflows for AiiDA-Yambo" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> yambo-aiida
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../get_started/index.html">Get started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Workflows for AiiDA-Yambo</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#description">Description</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#workflows-usage-and-tutorial">Workflows Usage and Tutorial</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Yambo Workflows Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#yamborestartwf">YamboRestartWf</a></li>
<li class="toctree-l4"><a class="reference internal" href="#yamboworkflow">YamboWorkflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#yamboconvergence">YamboConvergence</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../module_guide/index.html">Modules provided with aiida-yambo (API reference)</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">yambo-aiida</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">&lt;no title&gt;</a> &raquo;</li>
        
          <li><a href="index.html">Workflows for AiiDA-Yambo</a> &raquo;</li>
        
      <li>Yambo Workflows Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="yambo-workflows-tutorial">
<span id="tut-ref-to-yambo-tutorial"></span><h1>Yambo Workflows Tutorial<a class="headerlink" href="#yambo-workflows-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>The following shows how to use the workflows provided by the  <cite>aiida yambo</cite> plugin.</p>
<div class="section" id="yamborestartwf">
<h2>YamboRestartWf<a class="headerlink" href="#yamborestartwf" title="Permalink to this headline">¶</a></h2>
<p>This is the basic workflow and will run a single yambo calculation, with a tolerance
for failed calculations, and it will restart calculations that have failed due to</p>
<ul class="simple">
<li>Time Exhaustion on the queue.</li>
<li>Memory errors.</li>
</ul>
<p>After each calculation, this workflow will check the exit status(provided by the parser) and, if the calculation is failed,
try to fix some parameters in order to resubmit the calculation and obtain results. As inputs, we have to provide
the maximum number of attempted restarts.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">aiida.plugins</span> <span class="k">import</span> <span class="n">DataFactory</span><span class="p">,</span> <span class="n">CalculationFactory</span>
<span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">aiida.engine</span> <span class="k">import</span> <span class="n">submit</span>
<span class="kn">from</span> <span class="nn">aiida_yambo.workflows.yamborestart</span> <span class="k">import</span> <span class="n">YamboRestartWf</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="k">def</span> <span class="nf">get_options</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;SCF calculation.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--code&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;code_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The yambo codename to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--precode&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;precode_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The p2y codename to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--parent&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;parent_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The parent to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--restarts&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;max_restarts&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;maximum number of restarts&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--time&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;max wallclock in seconds&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--nodes&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;num_machines&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of machines&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--mpi&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;num_mpiprocs_per_machine&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of mpi processes per machine&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--threads&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;num_cores_per_mpiproc&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of threads per mpi process&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--queue_name&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;queue_name&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;queue(PBS) or partition(SLURM) name&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--qos&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;qos&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;qos name&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--account&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;account&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;account name&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1">###### setting the machine options ######</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;code_pk&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">code_pk</span><span class="p">,</span>
        <span class="s1">&#39;precode_pk&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">precode_pk</span><span class="p">,</span>
        <span class="s1">&#39;parent_pk&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">parent_pk</span><span class="p">,</span>
        <span class="s1">&#39;max_restarts&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">max_restarts</span><span class="p">,</span>
        <span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">max_wallclock_seconds</span><span class="p">,</span>
        <span class="s1">&#39;resources&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;num_machines&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">num_machines</span><span class="p">,</span>
            <span class="s2">&quot;num_mpiprocs_per_machine&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">num_mpiprocs_per_machine</span><span class="p">,</span>
            <span class="s2">&quot;num_cores_per_mpiproc&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">num_cores_per_mpiproc</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;custom_scheduler_commands&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;export OMP_NUM_THREADS=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">num_cores_per_mpiproc</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">queue_name</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;queue_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">queue_name</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">qos</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;qos&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">qos</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">account</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">account</span>

    <span class="k">return</span> <span class="n">options</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>

    <span class="c1">###### setting the gw parameters ######</span>

    <span class="n">Dict</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;dict&#39;</span><span class="p">)</span>

    <span class="n">params_gw</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ppa&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;gw0&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;HF_and_locXC&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;em1d&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;Chimod&#39;</span><span class="p">:</span> <span class="s1">&#39;hartree&#39;</span><span class="p">,</span>
            <span class="c1">#&#39;EXXRLvcs&#39;: 40,</span>
            <span class="c1">#&#39;EXXRLvcs_units&#39;: &#39;Ry&#39;,</span>
            <span class="s1">&#39;BndsRnXp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
            <span class="s1">&#39;NGsBlkXp&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;NGsBlkXp_units&#39;</span><span class="p">:</span> <span class="s1">&#39;Ry&#39;</span><span class="p">,</span>
            <span class="s1">&#39;GbndRnge&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
            <span class="s1">&#39;DysSolver&#39;</span><span class="p">:</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span>
            <span class="s1">&#39;QPkrange&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]],</span>
            <span class="s1">&#39;X_all_q_CPU&#39;</span><span class="p">:</span> <span class="s2">&quot;1 1 1 1&quot;</span><span class="p">,</span>
            <span class="s1">&#39;X_all_q_ROLEs&#39;</span><span class="p">:</span> <span class="s2">&quot;q k c v&quot;</span><span class="p">,</span>
            <span class="s1">&#39;SE_CPU&#39;</span><span class="p">:</span> <span class="s2">&quot;1 1 1&quot;</span><span class="p">,</span>
            <span class="s1">&#39;SE_ROLEs&#39;</span><span class="p">:</span> <span class="s2">&quot;q qp b&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="n">params_gw</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">params_gw</span><span class="p">)</span>

    <span class="c1">###### creation of the YamboCalculation ######</span>

    <span class="n">builder</span> <span class="o">=</span> <span class="n">YamboCalculation</span><span class="o">.</span><span class="n">get_builder</span><span class="p">()</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">max_wallclock_seconds</span> <span class="o">=</span> \
            <span class="n">options</span><span class="p">[</span><span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">]</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> \
            <span class="nb">dict</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;queue_name&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;queue_name&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;qos&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">qos</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;qos&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;account&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span>
        
    <span class="n">builder</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">custom_scheduler_commands</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;custom_scheduler_commands&#39;</span><span class="p">]</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">params_gw</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">precode_parameters</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="p">{})</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;INITIALISE&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;PARENT_DB&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;code_pk&#39;</span><span class="p">])</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">preprocessing_code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;precode_pk&#39;</span><span class="p">])</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">parent_folder</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;parent_pk&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remote_folder</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">max_restarts</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;max_restarts&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">builder</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">get_options</span><span class="p">()</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">main</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="n">submit</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Submitted YamboCalculation; with pk=&lt;</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">running</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="yamboworkflow">
<h2>YamboWorkflow<a class="headerlink" href="#yamboworkflow" title="Permalink to this headline">¶</a></h2>
<p>The <cite>YamboWorkflow</cite>  provides the functionality to run GW calculation from the PW step, passing in all the required
parameters for both the  KS DFT step with PW and the subsequent GW step. It uses the PwBaseWorkchain from <cite>aiida-quantumespresso</cite>
as a subworkflow to perform the first  DFT part and the <cite>YamboRestartWf</cite>  for the GW part.</p>
<p>Example usage.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env runaiida</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">aiida.plugins</span> <span class="k">import</span> <span class="n">DataFactory</span><span class="p">,</span> <span class="n">CalculationFactory</span>
<span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">aiida.engine</span> <span class="k">import</span> <span class="n">submit</span>
<span class="kn">from</span> <span class="nn">aiida_yambo.workflows.yambowf</span> <span class="k">import</span> <span class="n">YamboWorkflow</span>
<span class="kn">from</span> <span class="nn">aiida_quantumespresso.utils.pseudopotential</span> <span class="k">import</span> <span class="n">validate_and_prepare_pseudos_inputs</span>
<span class="kn">from</span> <span class="nn">ase</span> <span class="k">import</span> <span class="n">Atoms</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="k">def</span> <span class="nf">get_options</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;YAMBO calculation.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--yambocode&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;yambocode_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The yambo(main code) codename to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--parent&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;parent_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The parent to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--yamboprecode&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;yamboprecode_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The precode to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--pwcode&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;pwcode_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The pw to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--pseudo&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;pseudo_family&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The pseudo_family&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--time&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;max wallclock in seconds&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--nodes&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;num_machines&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of machines&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--mpi&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;num_mpiprocs_per_machine&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of mpi processes per machine&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--threads&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;num_cores_per_mpiproc&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of threads per mpi process&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--queue_name&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;queue_name&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;queue(PBS) or partition(SLURM) name&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--qos&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;qos&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;qos name&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--account&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;account&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;account name&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1">###### setting the machine options ######</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;yambocode_pk&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">yambocode_pk</span><span class="p">,</span>
        <span class="s1">&#39;yamboprecode_pk&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">yamboprecode_pk</span><span class="p">,</span>
        <span class="s1">&#39;pwcode_pk&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">pwcode_pk</span><span class="p">,</span>
        <span class="s1">&#39;pseudo_family&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">pseudo_family</span><span class="p">,</span>
        <span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">max_wallclock_seconds</span><span class="p">,</span>
        <span class="s1">&#39;resources&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;num_machines&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">num_machines</span><span class="p">,</span>
            <span class="s2">&quot;num_mpiprocs_per_machine&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">num_mpiprocs_per_machine</span><span class="p">,</span>
            <span class="s2">&quot;num_cores_per_mpiproc&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">num_cores_per_mpiproc</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;custom_scheduler_commands&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;export OMP_NUM_THREADS=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">num_cores_per_mpiproc</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">parent_pk</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;parent_pk&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">parent_pk</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">queue_name</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;queue_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">queue_name</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">qos</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;qos&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">qos</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">account</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">account</span>

    <span class="k">return</span> <span class="n">options</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>

    <span class="c1">###### setting the lattice structure ######</span>

    <span class="n">alat</span> <span class="o">=</span> <span class="mf">2.4955987320</span> <span class="c1"># Angstrom</span>
    <span class="n">the_cell</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.000000</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">0.500000</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>  <span class="mf">0.866025</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.000000</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">,</span>  <span class="mf">6.4436359260</span><span class="p">]]</span>

    <span class="n">atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;BNNB&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="mf">1.2477994910</span><span class="p">,</span> <span class="mf">0.7204172280</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.0000001250</span><span class="p">,</span> <span class="mf">1.4408346720</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">1.2477994910</span><span class="p">,</span> <span class="mf">0.7204172280</span><span class="p">,</span> <span class="mf">3.2218179630</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.0000001250</span><span class="p">,</span><span class="mf">1.4408346720</span><span class="p">,</span> <span class="mf">3.2218179630</span><span class="p">)],</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">the_cell</span><span class="p">,</span> <span class="n">scale_atoms</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">set_pbc</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">])</span>

    <span class="n">StructureData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;structure&#39;</span><span class="p">)</span>
    <span class="n">structure</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">atoms</span><span class="p">)</span>

    <span class="c1">###### setting the kpoints mesh ######</span>

    <span class="n">KpointsData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;array.kpoints&#39;</span><span class="p">)</span>
    <span class="n">kpoints</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>
    <span class="n">kpoints</span><span class="o">.</span><span class="n">set_kpoints_mesh</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

    <span class="c1">###### setting the scf parameters ######</span>

    <span class="n">Dict</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;dict&#39;</span><span class="p">)</span>
    <span class="n">params_scf</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;CONTROL&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;calculation&#39;</span><span class="p">:</span> <span class="s1">&#39;scf&#39;</span><span class="p">,</span>
            <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span>
            <span class="s1">&#39;wf_collect&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
        <span class="s1">&#39;SYSTEM&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;ecutwfc&#39;</span><span class="p">:</span> <span class="mf">130.</span><span class="p">,</span>
            <span class="s1">&#39;force_symmorphic&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;nbnd&#39;</span><span class="p">:</span> <span class="mi">20</span>
        <span class="p">},</span>
        <span class="s1">&#39;ELECTRONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;mixing_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;plain&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mixing_beta&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
            <span class="s1">&#39;conv_thr&#39;</span><span class="p">:</span> <span class="mf">1.e-8</span><span class="p">,</span>
            <span class="s1">&#39;diago_thr_init&#39;</span><span class="p">:</span> <span class="mf">5.0e-6</span><span class="p">,</span>
            <span class="s1">&#39;diago_full_acc&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">parameter_scf</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">params_scf</span><span class="p">)</span>

    <span class="n">params_nscf</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;CONTROL&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;calculation&#39;</span><span class="p">:</span> <span class="s1">&#39;nscf&#39;</span><span class="p">,</span>
            <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span>
            <span class="s1">&#39;wf_collect&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
        <span class="s1">&#39;SYSTEM&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;ecutwfc&#39;</span><span class="p">:</span> <span class="mf">130.</span><span class="p">,</span>
            <span class="s1">&#39;force_symmorphic&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;nbnd&#39;</span><span class="p">:</span> <span class="mi">500</span>
        <span class="p">},</span>
        <span class="s1">&#39;ELECTRONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;mixing_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;plain&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mixing_beta&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
            <span class="s1">&#39;conv_thr&#39;</span><span class="p">:</span> <span class="mf">1.e-8</span><span class="p">,</span>
            <span class="s1">&#39;diagonalization&#39;</span><span class="p">:</span> <span class="s1">&#39;david&#39;</span><span class="p">,</span>
            <span class="s1">&#39;diago_thr_init&#39;</span><span class="p">:</span> <span class="mf">5.0e-6</span><span class="p">,</span>
            <span class="s1">&#39;diago_full_acc&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">parameter_nscf</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">params_nscf</span><span class="p">)</span>

    <span class="n">KpointsData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;array.kpoints&#39;</span><span class="p">)</span>
    <span class="n">kpoints</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>
    <span class="n">kpoints</span><span class="o">.</span><span class="n">set_kpoints_mesh</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">alat</span> <span class="o">=</span> <span class="mf">2.4955987320</span> <span class="c1"># Angstrom</span>
    <span class="n">the_cell</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.000000</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">0.500000</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>  <span class="mf">0.866025</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.000000</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">,</span>  <span class="mf">6.4436359260</span><span class="p">]]</span>

    <span class="n">atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;BNNB&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="mf">1.2477994910</span><span class="p">,</span> <span class="mf">0.7204172280</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.0000001250</span><span class="p">,</span> <span class="mf">1.4408346720</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">1.2477994910</span><span class="p">,</span> <span class="mf">0.7204172280</span><span class="p">,</span> <span class="mf">3.2218179630</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.0000001250</span><span class="p">,</span><span class="mf">1.4408346720</span><span class="p">,</span> <span class="mf">3.2218179630</span><span class="p">)],</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">the_cell</span><span class="p">,</span> <span class="n">scale_atoms</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">set_pbc</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">])</span>

    <span class="n">StructureData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;structure&#39;</span><span class="p">)</span>
    <span class="n">structure</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">atoms</span><span class="p">)</span>


    <span class="n">params_gw</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ppa&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;gw0&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;HF_and_locXC&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;em1d&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;Chimod&#39;</span><span class="p">:</span> <span class="s1">&#39;hartree&#39;</span><span class="p">,</span>
            <span class="c1">#&#39;EXXRLvcs&#39;: 40,</span>
            <span class="c1">#&#39;EXXRLvcs_units&#39;: &#39;Ry&#39;,</span>
            <span class="s1">&#39;BndsRnXp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span>
            <span class="s1">&#39;NGsBlkXp&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;NGsBlkXp_units&#39;</span><span class="p">:</span> <span class="s1">&#39;Ry&#39;</span><span class="p">,</span>
            <span class="s1">&#39;GbndRnge&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span>
            <span class="s1">&#39;DysSolver&#39;</span><span class="p">:</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span>
            <span class="s1">&#39;QPkrange&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]],</span>
            <span class="s1">&#39;X_all_q_CPU&#39;</span><span class="p">:</span> <span class="s2">&quot;1 1 1 1&quot;</span><span class="p">,</span>
            <span class="s1">&#39;X_all_q_ROLEs&#39;</span><span class="p">:</span> <span class="s2">&quot;q k c v&quot;</span><span class="p">,</span>
            <span class="s1">&#39;SE_CPU&#39;</span><span class="p">:</span> <span class="s2">&quot;1 1 1&quot;</span><span class="p">,</span>
            <span class="s1">&#39;SE_ROLEs&#39;</span><span class="p">:</span> <span class="s2">&quot;q qp b&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="n">params_gw</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">params_gw</span><span class="p">)</span>


    <span class="n">builder</span> <span class="o">=</span> <span class="n">YamboWorkflow</span><span class="o">.</span><span class="n">get_builder</span><span class="p">()</span>


    <span class="c1">##################scf+nscf part of the builder</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameter_scf</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">kpoints</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">max_wallclock_seconds</span> <span class="o">=</span> \
            <span class="n">options</span><span class="p">[</span><span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">]</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> \
            <span class="nb">dict</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;queue_name&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;queue_name&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;qos&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">qos</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;qos&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;account&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">custom_scheduler_commands</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;custom_scheduler_commands&#39;</span><span class="p">]</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">structure</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameter_nscf</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">kpoints</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;pwcode_pk&#39;</span><span class="p">])</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;pwcode_pk&#39;</span><span class="p">])</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">pseudos</span> <span class="o">=</span> <span class="n">validate_and_prepare_pseudos_inputs</span><span class="p">(</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span> <span class="n">pseudo_family</span> <span class="o">=</span> <span class="n">Str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;pseudo_family&#39;</span><span class="p">])</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">pseudos</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">pseudos</span>

    <span class="c1">##################yambo part of the builder</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">max_wallclock_seconds</span> <span class="o">=</span> \
            <span class="n">options</span><span class="p">[</span><span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">]</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> \
            <span class="nb">dict</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;queue_name&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;queue_name&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;qos&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">qos</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;qos&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;account&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">params_gw</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">precode_parameters</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="p">{})</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;INITIALISE&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;PARENT_DB&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">max_restarts</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">preprocessing_code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;yamboprecode_pk&#39;</span><span class="p">])</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;yambocode_pk&#39;</span><span class="p">])</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">parent_folder</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;parent_pk&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remote_folder</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">get_options</span><span class="p">()</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">main</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="n">submit</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Submitted YamboCalculation; with pk=&lt;</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">running</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="yamboconvergence">
<h2>YamboConvergence<a class="headerlink" href="#yamboconvergence" title="Permalink to this headline">¶</a></h2>
<p>The <cite>YamboConvergence</cite> provides the functionality to run G0W0 calculations(using YamboWorkflow) over several parameters,
and it can be used (for now) to perform multi-parameter investigation of the quasiparticle corrections.
It is possible to accomplish automatic convergence by iteration over one or more parameter in a serial way,
or to explore a provided 2-dimensional space of parameters, in order to perform a successive extrapolation of the results.
Let’s see the case of automatic convergence over an arbitrary number of parameters (“type”: 1D_convergence):</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env runaiida</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">aiida.plugins</span> <span class="k">import</span> <span class="n">DataFactory</span><span class="p">,</span> <span class="n">CalculationFactory</span>
<span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">aiida.engine</span> <span class="k">import</span> <span class="n">submit</span>
<span class="kn">from</span> <span class="nn">aiida_yambo.workflows.yambowf</span> <span class="k">import</span> <span class="n">YamboWorkflow</span>
<span class="kn">from</span> <span class="nn">aiida_quantumespresso.utils.pseudopotential</span> <span class="k">import</span> <span class="n">validate_and_prepare_pseudos_inputs</span>
<span class="kn">from</span> <span class="nn">ase</span> <span class="k">import</span> <span class="n">Atoms</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="k">def</span> <span class="nf">get_options</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;YAMBO calculation.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--yambocode&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;yambocode_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The yambo(main code) codename to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--parent&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;parent_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The parent to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--yamboprecode&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;yamboprecode_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The precode to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--pwcode&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;pwcode_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The pw to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--pseudo&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;pseudo_family&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The pseudo_family&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--time&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;max wallclock in seconds&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--nodes&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;num_machines&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of machines&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--mpi&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;num_mpiprocs_per_machine&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of mpi processes per machine&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--threads&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;num_cores_per_mpiproc&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of threads per mpi process&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--queue_name&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;queue_name&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;queue(PBS) or partition(SLURM) name&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--qos&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;qos&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;qos name&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--account&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;account&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;account name&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1">###### setting the machine options ######</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;yambocode_pk&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">yambocode_pk</span><span class="p">,</span>
        <span class="s1">&#39;yamboprecode_pk&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">yamboprecode_pk</span><span class="p">,</span>
        <span class="s1">&#39;pwcode_pk&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">pwcode_pk</span><span class="p">,</span>
        <span class="s1">&#39;pseudo_family&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">pseudo_family</span><span class="p">,</span>
        <span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">max_wallclock_seconds</span><span class="p">,</span>
        <span class="s1">&#39;resources&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;num_machines&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">num_machines</span><span class="p">,</span>
            <span class="s2">&quot;num_mpiprocs_per_machine&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">num_mpiprocs_per_machine</span><span class="p">,</span>
            <span class="s2">&quot;num_cores_per_mpiproc&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">num_cores_per_mpiproc</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;custom_scheduler_commands&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;export OMP_NUM_THREADS=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">num_cores_per_mpiproc</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">parent_pk</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;parent_pk&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">parent_pk</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">queue_name</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;queue_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">queue_name</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">qos</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;qos&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">qos</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">account</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">account</span>

    <span class="k">return</span> <span class="n">options</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>

    <span class="c1">###### setting the lattice structure ######</span>

    <span class="n">alat</span> <span class="o">=</span> <span class="mf">2.4955987320</span> <span class="c1"># Angstrom</span>
    <span class="n">the_cell</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.000000</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">0.500000</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>  <span class="mf">0.866025</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.000000</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">,</span>  <span class="mf">6.4436359260</span><span class="p">]]</span>

    <span class="n">atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;BNNB&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="mf">1.2477994910</span><span class="p">,</span> <span class="mf">0.7204172280</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.0000001250</span><span class="p">,</span> <span class="mf">1.4408346720</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">1.2477994910</span><span class="p">,</span> <span class="mf">0.7204172280</span><span class="p">,</span> <span class="mf">3.2218179630</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.0000001250</span><span class="p">,</span><span class="mf">1.4408346720</span><span class="p">,</span> <span class="mf">3.2218179630</span><span class="p">)],</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">the_cell</span><span class="p">,</span> <span class="n">scale_atoms</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">set_pbc</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">])</span>

    <span class="n">StructureData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;structure&#39;</span><span class="p">)</span>
    <span class="n">structure</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">atoms</span><span class="p">)</span>

    <span class="c1">###### setting the kpoints mesh ######</span>

    <span class="n">KpointsData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;array.kpoints&#39;</span><span class="p">)</span>
    <span class="n">kpoints</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>
    <span class="n">kpoints</span><span class="o">.</span><span class="n">set_kpoints_mesh</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

    <span class="c1">###### setting the scf parameters ######</span>

    <span class="n">Dict</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;dict&#39;</span><span class="p">)</span>
    <span class="n">params_scf</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;CONTROL&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;calculation&#39;</span><span class="p">:</span> <span class="s1">&#39;scf&#39;</span><span class="p">,</span>
            <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span>
            <span class="s1">&#39;wf_collect&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
        <span class="s1">&#39;SYSTEM&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;ecutwfc&#39;</span><span class="p">:</span> <span class="mf">130.</span><span class="p">,</span>
            <span class="s1">&#39;force_symmorphic&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;nbnd&#39;</span><span class="p">:</span> <span class="mi">20</span>
        <span class="p">},</span>
        <span class="s1">&#39;ELECTRONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;mixing_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;plain&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mixing_beta&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
            <span class="s1">&#39;conv_thr&#39;</span><span class="p">:</span> <span class="mf">1.e-8</span><span class="p">,</span>
            <span class="s1">&#39;diago_thr_init&#39;</span><span class="p">:</span> <span class="mf">5.0e-6</span><span class="p">,</span>
            <span class="s1">&#39;diago_full_acc&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">parameter_scf</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">params_scf</span><span class="p">)</span>

    <span class="n">params_nscf</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;CONTROL&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;calculation&#39;</span><span class="p">:</span> <span class="s1">&#39;nscf&#39;</span><span class="p">,</span>
            <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span>
            <span class="s1">&#39;wf_collect&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
        <span class="s1">&#39;SYSTEM&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;ecutwfc&#39;</span><span class="p">:</span> <span class="mf">130.</span><span class="p">,</span>
            <span class="s1">&#39;force_symmorphic&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;nbnd&#39;</span><span class="p">:</span> <span class="mi">500</span>
        <span class="p">},</span>
        <span class="s1">&#39;ELECTRONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;mixing_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;plain&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mixing_beta&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
            <span class="s1">&#39;conv_thr&#39;</span><span class="p">:</span> <span class="mf">1.e-8</span><span class="p">,</span>
            <span class="s1">&#39;diagonalization&#39;</span><span class="p">:</span> <span class="s1">&#39;david&#39;</span><span class="p">,</span>
            <span class="s1">&#39;diago_thr_init&#39;</span><span class="p">:</span> <span class="mf">5.0e-6</span><span class="p">,</span>
            <span class="s1">&#39;diago_full_acc&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">parameter_nscf</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">params_nscf</span><span class="p">)</span>

    <span class="n">KpointsData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;array.kpoints&#39;</span><span class="p">)</span>
    <span class="n">kpoints</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>
    <span class="n">kpoints</span><span class="o">.</span><span class="n">set_kpoints_mesh</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">alat</span> <span class="o">=</span> <span class="mf">2.4955987320</span> <span class="c1"># Angstrom</span>
    <span class="n">the_cell</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.000000</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">0.500000</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>  <span class="mf">0.866025</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.000000</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">,</span>  <span class="mf">6.4436359260</span><span class="p">]]</span>

    <span class="n">atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;BNNB&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="mf">1.2477994910</span><span class="p">,</span> <span class="mf">0.7204172280</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.0000001250</span><span class="p">,</span> <span class="mf">1.4408346720</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">1.2477994910</span><span class="p">,</span> <span class="mf">0.7204172280</span><span class="p">,</span> <span class="mf">3.2218179630</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.0000001250</span><span class="p">,</span><span class="mf">1.4408346720</span><span class="p">,</span> <span class="mf">3.2218179630</span><span class="p">)],</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">the_cell</span><span class="p">,</span> <span class="n">scale_atoms</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">set_pbc</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">])</span>

    <span class="n">StructureData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;structure&#39;</span><span class="p">)</span>
    <span class="n">structure</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">atoms</span><span class="p">)</span>


    <span class="n">params_gw</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ppa&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;gw0&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;HF_and_locXC&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;em1d&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;Chimod&#39;</span><span class="p">:</span> <span class="s1">&#39;hartree&#39;</span><span class="p">,</span>
            <span class="c1">#&#39;EXXRLvcs&#39;: 40,</span>
            <span class="c1">#&#39;EXXRLvcs_units&#39;: &#39;Ry&#39;,</span>
            <span class="s1">&#39;BndsRnXp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span>
            <span class="s1">&#39;NGsBlkXp&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;NGsBlkXp_units&#39;</span><span class="p">:</span> <span class="s1">&#39;Ry&#39;</span><span class="p">,</span>
            <span class="s1">&#39;GbndRnge&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span>
            <span class="s1">&#39;DysSolver&#39;</span><span class="p">:</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span>
            <span class="s1">&#39;QPkrange&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]],</span>
            <span class="s1">&#39;X_all_q_CPU&#39;</span><span class="p">:</span> <span class="s2">&quot;1 1 1 1&quot;</span><span class="p">,</span>
            <span class="s1">&#39;X_all_q_ROLEs&#39;</span><span class="p">:</span> <span class="s2">&quot;q k c v&quot;</span><span class="p">,</span>
            <span class="s1">&#39;SE_CPU&#39;</span><span class="p">:</span> <span class="s2">&quot;1 1 1&quot;</span><span class="p">,</span>
            <span class="s1">&#39;SE_ROLEs&#39;</span><span class="p">:</span> <span class="s2">&quot;q qp b&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="n">params_gw</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">params_gw</span><span class="p">)</span>


    <span class="n">builder</span> <span class="o">=</span> <span class="n">YamboWorkflow</span><span class="o">.</span><span class="n">get_builder</span><span class="p">()</span>


    <span class="c1">##################scf+nscf part of the builder</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameter_scf</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">kpoints</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">max_wallclock_seconds</span> <span class="o">=</span> \
            <span class="n">options</span><span class="p">[</span><span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">]</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> \
            <span class="nb">dict</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;queue_name&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;queue_name&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;qos&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">qos</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;qos&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;account&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">custom_scheduler_commands</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;custom_scheduler_commands&#39;</span><span class="p">]</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">structure</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameter_nscf</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;pwcode_pk&#39;</span><span class="p">])</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;pwcode_pk&#39;</span><span class="p">])</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">pseudos</span> <span class="o">=</span> <span class="n">validate_and_prepare_pseudos_inputs</span><span class="p">(</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span> <span class="n">pseudo_family</span> <span class="o">=</span> <span class="n">Str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;pseudo_family&#39;</span><span class="p">])</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">pseudos</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">pseudos</span>

    <span class="c1">##################yambo part of the builder</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">max_wallclock_seconds</span> <span class="o">=</span> \
            <span class="n">options</span><span class="p">[</span><span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">]</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> \
            <span class="nb">dict</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;queue_name&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;queue_name&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;qos&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">qos</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;qos&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;account&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">params_gw</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">precode_parameters</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="p">{})</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;INITIALISE&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;PARENT_DB&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">max_restarts</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">preprocessing_code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;yamboprecode_pk&#39;</span><span class="p">])</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;yambocode_pk&#39;</span><span class="p">])</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">parent_folder</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;parent_pk&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remote_folder</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">workflow_settings</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;1D_convergence&#39;</span><span class="p">,</span><span class="s1">&#39;what&#39;</span><span class="p">:</span><span class="s1">&#39;gap&#39;</span><span class="p">,</span><span class="s1">&#39;where&#39;</span><span class="p">:[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">)],</span><span class="s1">&#39;where_in_words&#39;</span><span class="p">:[</span><span class="s1">&#39;Gamma&#39;</span><span class="p">]})</span>
    <span class="c1">#&#39;what&#39;: &#39;single-levels&#39;,&#39;where&#39;:[(1,8),(1,9)]</span>
    <span class="n">var_to_conv</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;var&#39;</span><span class="p">:[</span><span class="s1">&#39;BndsRnXp&#39;</span><span class="p">,</span><span class="s1">&#39;GbndRnge&#39;</span><span class="p">],</span><span class="s1">&#39;delta&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]],</span> <span class="s1">&#39;steps&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;max_restarts&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> \
                                 <span class="s1">&#39;conv_thr&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;conv_window&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
                   <span class="p">{</span><span class="s1">&#39;var&#39;</span><span class="p">:</span><span class="s1">&#39;NGsBlkXp&#39;</span><span class="p">,</span><span class="s1">&#39;delta&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;steps&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;max_restarts&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> \
                                <span class="s1">&#39;conv_thr&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;conv_window&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
                   <span class="p">{</span><span class="s1">&#39;var&#39;</span><span class="p">:[</span><span class="s1">&#39;BndsRnXp&#39;</span><span class="p">,</span><span class="s1">&#39;GbndRnge&#39;</span><span class="p">],</span><span class="s1">&#39;delta&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]],</span> <span class="s1">&#39;steps&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;max_restarts&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> \
                                 <span class="s1">&#39;conv_thr&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;conv_window&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
                   <span class="p">{</span><span class="s1">&#39;var&#39;</span><span class="p">:</span><span class="s1">&#39;NGsBlkXp&#39;</span><span class="p">,</span><span class="s1">&#39;delta&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;steps&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;max_restarts&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> \
                                 <span class="s1">&#39;conv_thr&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;conv_window&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},]</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                   {&#39;var&#39;:&#39;kpoints&#39;,&#39;delta&#39;: 1, &#39;steps&#39;: 2, &#39;max_restarts&#39;: 2, \</span>
<span class="sd">                                 &#39;conv_thr&#39;: 0.1, &#39;conv_window&#39;: 2, &#39;what&#39;:&#39;gap&#39;,&#39;where&#39;:[(1,1)],}]</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_to_conv</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-th variable will be </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">var_to_conv</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]))</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">parameters_space</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="nb">list</span> <span class="o">=</span> <span class="n">var_to_conv</span><span class="p">)</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">get_options</span><span class="p">()</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">main</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="n">submit</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Submitted YamboCalculation; with pk=&lt;</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">running</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
</pre></div>
</div>
<p>As you can see, we have to provide workflow_settings, which encode some workflow logic:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;1D_convergence&#39;</span><span class="p">,</span><span class="s1">&#39;what&#39;</span><span class="p">:</span><span class="s1">&#39;gap&#39;</span><span class="p">,</span><span class="s1">&#39;where&#39;</span><span class="p">:[(</span><span class="n">k_v</span><span class="p">,</span><span class="n">vbM</span><span class="p">,</span><span class="n">k_c</span><span class="p">,</span><span class="n">cbm</span><span class="p">)],</span><span class="s1">&#39;where_in_words&#39;</span><span class="p">:[</span><span class="s1">&#39;Gamma&#39;</span><span class="p">]})</span>
</pre></div>
</div>
<p>The workflow submitted here looks for convergence on different parameters, searching each step a given parameter(1D). The quantity that tries
to converge is the gap(‘what’) between given bands evaluated at fixed k-points. It is possible to choose also and indirect gap(notice that,
changing the k-point mesh, the k-points will change index). The other functionality of the converge workflow is to converge single levels
(‘gap’-&gt;’single-levels’, [(k_v,vbM,k_c,cbm)]-&gt;[(k,b)]), useful in the study of molecules. It is possible also to search convergence simultaneously for
multiple gaps/levels, just adding tuples in the ‘where’ list. The workflow will take care of it and doesn’t stop until all the quantities are
converged(or the maximum restarts are reached).</p>
<p>The complete workflow will return the results of the convergence iterations, as well as a final converged calculation, from which we can parse the
converged parameters, and a complete story of all the calculations of the workflow with all the information provided.</p>
<p>The data can be plotted using a function in :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiida_yambo.utils.plot_utilities</span> <span class="k">import</span> <span class="n">plot_conv</span>
<span class="n">plot_conv</span><span class="p">(</span><span class="o">&lt;</span><span class="n">workflow_pk</span><span class="o">&gt;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Gap at Gamma for bulk hBN&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/conv_hBN.png" src="../../_images/conv_hBN.png" />
<p>Let’s see the case of 2-dimensional space exploration:</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env runaiida</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">aiida.plugins</span> <span class="k">import</span> <span class="n">DataFactory</span><span class="p">,</span> <span class="n">CalculationFactory</span>
<span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">aiida.engine</span> <span class="k">import</span> <span class="n">submit</span>
<span class="kn">from</span> <span class="nn">aiida_yambo.workflows.yambowf</span> <span class="k">import</span> <span class="n">YamboWorkflow</span>
<span class="kn">from</span> <span class="nn">aiida_quantumespresso.utils.pseudopotential</span> <span class="k">import</span> <span class="n">validate_and_prepare_pseudos_inputs</span>
<span class="kn">from</span> <span class="nn">ase</span> <span class="k">import</span> <span class="n">Atoms</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="k">def</span> <span class="nf">get_options</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;YAMBO calculation.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--yambocode&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;yambocode_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The yambo(main code) codename to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--parent&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;parent_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The parent to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--yamboprecode&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;yamboprecode_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The precode to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--pwcode&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;pwcode_pk&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The pw to use&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--pseudo&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;pseudo_family&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The pseudo_family&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--time&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;max wallclock in seconds&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--nodes&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;num_machines&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of machines&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--mpi&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;num_mpiprocs_per_machine&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of mpi processes per machine&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--threads&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;num_cores_per_mpiproc&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of threads per mpi process&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--queue_name&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;queue_name&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;queue(PBS) or partition(SLURM) name&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--qos&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;qos&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;qos name&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--account&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;account&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;account name&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1">###### setting the machine options ######</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;yambocode_pk&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">yambocode_pk</span><span class="p">,</span>
        <span class="s1">&#39;yamboprecode_pk&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">yamboprecode_pk</span><span class="p">,</span>
        <span class="s1">&#39;pwcode_pk&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">pwcode_pk</span><span class="p">,</span>
        <span class="s1">&#39;pseudo_family&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">pseudo_family</span><span class="p">,</span>
        <span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">max_wallclock_seconds</span><span class="p">,</span>
        <span class="s1">&#39;resources&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;num_machines&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">num_machines</span><span class="p">,</span>
            <span class="s2">&quot;num_mpiprocs_per_machine&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">num_mpiprocs_per_machine</span><span class="p">,</span>
            <span class="s2">&quot;num_cores_per_mpiproc&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">num_cores_per_mpiproc</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;custom_scheduler_commands&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;export OMP_NUM_THREADS=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">num_cores_per_mpiproc</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">parent_pk</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;parent_pk&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">parent_pk</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">queue_name</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;queue_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">queue_name</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">qos</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;qos&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">qos</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">account</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">account</span>

    <span class="k">return</span> <span class="n">options</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>

    <span class="c1">###### setting the lattice structure ######</span>

    <span class="n">alat</span> <span class="o">=</span> <span class="mf">2.4955987320</span> <span class="c1"># Angstrom</span>
    <span class="n">the_cell</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.000000</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">0.500000</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>  <span class="mf">0.866025</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.000000</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">,</span>  <span class="mf">6.4436359260</span><span class="p">]]</span>

    <span class="n">atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;BNNB&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="mf">1.2477994910</span><span class="p">,</span> <span class="mf">0.7204172280</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.0000001250</span><span class="p">,</span> <span class="mf">1.4408346720</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">1.2477994910</span><span class="p">,</span> <span class="mf">0.7204172280</span><span class="p">,</span> <span class="mf">3.2218179630</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.0000001250</span><span class="p">,</span><span class="mf">1.4408346720</span><span class="p">,</span> <span class="mf">3.2218179630</span><span class="p">)],</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">the_cell</span><span class="p">,</span> <span class="n">scale_atoms</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">set_pbc</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">])</span>

    <span class="n">StructureData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;structure&#39;</span><span class="p">)</span>
    <span class="n">structure</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">atoms</span><span class="p">)</span>

    <span class="c1">###### setting the kpoints mesh ######</span>

    <span class="n">KpointsData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;array.kpoints&#39;</span><span class="p">)</span>
    <span class="n">kpoints</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>
    <span class="n">kpoints</span><span class="o">.</span><span class="n">set_kpoints_mesh</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

    <span class="c1">###### setting the scf parameters ######</span>

    <span class="n">Dict</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;dict&#39;</span><span class="p">)</span>
    <span class="n">params_scf</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;CONTROL&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;calculation&#39;</span><span class="p">:</span> <span class="s1">&#39;scf&#39;</span><span class="p">,</span>
            <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span>
            <span class="s1">&#39;wf_collect&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
        <span class="s1">&#39;SYSTEM&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;ecutwfc&#39;</span><span class="p">:</span> <span class="mf">130.</span><span class="p">,</span>
            <span class="s1">&#39;force_symmorphic&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;nbnd&#39;</span><span class="p">:</span> <span class="mi">20</span>
        <span class="p">},</span>
        <span class="s1">&#39;ELECTRONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;mixing_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;plain&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mixing_beta&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
            <span class="s1">&#39;conv_thr&#39;</span><span class="p">:</span> <span class="mf">1.e-8</span><span class="p">,</span>
            <span class="s1">&#39;diago_thr_init&#39;</span><span class="p">:</span> <span class="mf">5.0e-6</span><span class="p">,</span>
            <span class="s1">&#39;diago_full_acc&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">parameter_scf</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">params_scf</span><span class="p">)</span>

    <span class="n">params_nscf</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;CONTROL&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;calculation&#39;</span><span class="p">:</span> <span class="s1">&#39;nscf&#39;</span><span class="p">,</span>
            <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span>
            <span class="s1">&#39;wf_collect&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
        <span class="s1">&#39;SYSTEM&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;ecutwfc&#39;</span><span class="p">:</span> <span class="mf">130.</span><span class="p">,</span>
            <span class="s1">&#39;force_symmorphic&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;nbnd&#39;</span><span class="p">:</span> <span class="mi">500</span>
        <span class="p">},</span>
        <span class="s1">&#39;ELECTRONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;mixing_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;plain&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mixing_beta&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
            <span class="s1">&#39;conv_thr&#39;</span><span class="p">:</span> <span class="mf">1.e-8</span><span class="p">,</span>
            <span class="s1">&#39;diagonalization&#39;</span><span class="p">:</span> <span class="s1">&#39;david&#39;</span><span class="p">,</span>
            <span class="s1">&#39;diago_thr_init&#39;</span><span class="p">:</span> <span class="mf">5.0e-6</span><span class="p">,</span>
            <span class="s1">&#39;diago_full_acc&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">parameter_nscf</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">params_nscf</span><span class="p">)</span>

    <span class="n">KpointsData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;array.kpoints&#39;</span><span class="p">)</span>
    <span class="n">kpoints</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>
    <span class="n">kpoints</span><span class="o">.</span><span class="n">set_kpoints_mesh</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">alat</span> <span class="o">=</span> <span class="mf">2.4955987320</span> <span class="c1"># Angstrom</span>
    <span class="n">the_cell</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.000000</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">0.500000</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>  <span class="mf">0.866025</span><span class="o">*</span><span class="n">alat</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.000000</span><span class="p">,</span>   <span class="mf">0.000000</span><span class="p">,</span>  <span class="mf">6.4436359260</span><span class="p">]]</span>

    <span class="n">atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;BNNB&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="mf">1.2477994910</span><span class="p">,</span> <span class="mf">0.7204172280</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.0000001250</span><span class="p">,</span> <span class="mf">1.4408346720</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">1.2477994910</span><span class="p">,</span> <span class="mf">0.7204172280</span><span class="p">,</span> <span class="mf">3.2218179630</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.0000001250</span><span class="p">,</span><span class="mf">1.4408346720</span><span class="p">,</span> <span class="mf">3.2218179630</span><span class="p">)],</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">the_cell</span><span class="p">,</span> <span class="n">scale_atoms</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">set_pbc</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">])</span>

    <span class="n">StructureData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;structure&#39;</span><span class="p">)</span>
    <span class="n">structure</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">atoms</span><span class="p">)</span>


    <span class="n">params_gw</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ppa&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;gw0&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;HF_and_locXC&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;em1d&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;Chimod&#39;</span><span class="p">:</span> <span class="s1">&#39;hartree&#39;</span><span class="p">,</span>
            <span class="c1">#&#39;EXXRLvcs&#39;: 40,</span>
            <span class="c1">#&#39;EXXRLvcs_units&#39;: &#39;Ry&#39;,</span>
            <span class="s1">&#39;BndsRnXp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span>
            <span class="s1">&#39;NGsBlkXp&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;NGsBlkXp_units&#39;</span><span class="p">:</span> <span class="s1">&#39;Ry&#39;</span><span class="p">,</span>
            <span class="s1">&#39;GbndRnge&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span>
            <span class="s1">&#39;DysSolver&#39;</span><span class="p">:</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span>
            <span class="s1">&#39;QPkrange&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]],</span>
            <span class="s1">&#39;X_all_q_CPU&#39;</span><span class="p">:</span> <span class="s2">&quot;1 1 1 1&quot;</span><span class="p">,</span>
            <span class="s1">&#39;X_all_q_ROLEs&#39;</span><span class="p">:</span> <span class="s2">&quot;q k c v&quot;</span><span class="p">,</span>
            <span class="s1">&#39;SE_CPU&#39;</span><span class="p">:</span> <span class="s2">&quot;1 1 1&quot;</span><span class="p">,</span>
            <span class="s1">&#39;SE_ROLEs&#39;</span><span class="p">:</span> <span class="s2">&quot;q qp b&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="n">params_gw</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">params_gw</span><span class="p">)</span>


    <span class="n">builder</span> <span class="o">=</span> <span class="n">YamboWorkflow</span><span class="o">.</span><span class="n">get_builder</span><span class="p">()</span>


    <span class="c1">##################scf+nscf part of the builder</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameter_scf</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">kpoints</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">max_wallclock_seconds</span> <span class="o">=</span> \
            <span class="n">options</span><span class="p">[</span><span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">]</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> \
            <span class="nb">dict</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;queue_name&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;queue_name&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;qos&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">qos</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;qos&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;account&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">custom_scheduler_commands</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;custom_scheduler_commands&#39;</span><span class="p">]</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">structure</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameter_nscf</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">metadata</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;pwcode_pk&#39;</span><span class="p">])</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;pwcode_pk&#39;</span><span class="p">])</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">pseudos</span> <span class="o">=</span> <span class="n">validate_and_prepare_pseudos_inputs</span><span class="p">(</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span> <span class="n">pseudo_family</span> <span class="o">=</span> <span class="n">Str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;pseudo_family&#39;</span><span class="p">])</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">nscf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">pseudos</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">scf</span><span class="o">.</span><span class="n">pw</span><span class="o">.</span><span class="n">pseudos</span>

    <span class="c1">##################yambo part of the builder</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">max_wallclock_seconds</span> <span class="o">=</span> \
            <span class="n">options</span><span class="p">[</span><span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">]</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> \
            <span class="nb">dict</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;queue_name&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;queue_name&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;qos&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">qos</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;qos&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;account&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">params_gw</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">precode_parameters</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="p">{})</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;INITIALISE&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;PARENT_DB&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">max_restarts</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">preprocessing_code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;yamboprecode_pk&#39;</span><span class="p">])</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">ywfl</span><span class="o">.</span><span class="n">yres</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;yambocode_pk&#39;</span><span class="p">])</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">parent_folder</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;parent_pk&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remote_folder</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">workflow_settings</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;2D_space&#39;</span><span class="p">,</span><span class="s1">&#39;what&#39;</span><span class="p">:</span><span class="s1">&#39;gap&#39;</span><span class="p">,</span><span class="s1">&#39;where&#39;</span><span class="p">:[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">)],</span><span class="s1">&#39;where_in_words&#39;</span><span class="p">:[</span><span class="s1">&#39;Gamma&#39;</span><span class="p">]})</span>
    <span class="c1">#&#39;what&#39;: &#39;single-levels&#39;,&#39;where&#39;:[(1,8),(1,9)]</span>
    <span class="n">para_space</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;var&#39;</span><span class="p">:[</span><span class="s1">&#39;BndsRnXp&#39;</span><span class="p">,</span><span class="s1">&#39;GbndRnge&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;space&#39;</span><span class="p">:</span> <span class="p">[[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">]],</span> \
                              <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">75</span><span class="p">]],</span> \
                              <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">75</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">]]],</span> \
                                 <span class="s1">&#39;max_restarts&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,},</span>
                  <span class="p">{</span><span class="s1">&#39;var&#39;</span><span class="p">:[</span><span class="s1">&#39;BndsRnXp&#39;</span><span class="p">,</span><span class="s1">&#39;GbndRnge&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;space&#39;</span><span class="p">:</span> <span class="p">[[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">75</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">75</span><span class="p">]]],</span>
                                 <span class="s1">&#39;max_restarts&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,}]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_to_conv</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-th variable will be </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">var_to_conv</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]))</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">parameters_space</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="nb">list</span> <span class="o">=</span> <span class="n">var_to_conv</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">get_options</span><span class="p">()</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">main</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="n">submit</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Submitted YamboCalculation; with pk=&lt;</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">running</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
</pre></div>
</div>
<p>It is possible to use some functions(that may be as a starting point for more complex parsing) to parse and plot the results of
this type of workflow, in order to perform successive analysis.</p>
<img alt="../../_images/2d_hBN.png" src="../../_images/2d_hBN.png" />
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../module_guide/index.html" class="btn btn-neutral float-right" title="Modules provided with aiida-yambo (API reference)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Workflows for AiiDA-Yambo" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2020, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and CNR NANO Modena, Italy. All rights reserved.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>